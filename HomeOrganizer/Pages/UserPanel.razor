@using HomeOrganizer.Components
@using HomeOrganizer.Components.Dialogs;
@using HomeOrganizer.Components.Errors
@using HomeOrganizer.Components.Features;
@using HomeOrganizer.Models.Bases;
@using HomeOrganizer.Models.Features;
@using HomeOrganizer.Models.User;
@using MudBlazor.Services;
@using MyWebsiteBlazor.Data.Database;
@using System.Reflection;

@inject UserService userService
@inject IDialogService DialogService
@inject NavigationManager navigationManager

@page "/UserPanel"
<PageTitle> Home Organizer </PageTitle>

@if (user == null)
{
    <UserPanelError />
}
else
{
    <MudPaper Width="900px" Height="600px" Class="mx-auto mt-10 mud-theme-transparent" Elevation="0">

        <MudStack Row="true" Style="width:100%; height:100%;" Class="mud-theme-transparent" Spacing="3">
            <MudPaper Width="180px" Class="mud-theme-transparent" Elevation="0">
                @if (!user.RightUserPanelNavigation)
                {
                    <UserPanelNavigation OnNavigationChanged="HandleNavigationChanged" />
                }
            </MudPaper>
            <MudPaper Width="540px" Class="pa-4" Elevation="0">
                CURRENT PANEL: @currentPanel
            </MudPaper>
            <MudPaper Width="180px" Class="mud-theme-transparent" Elevation="0">
                @if (user.RightUserPanelNavigation)
                {
                    <UserPanelNavigation OnNavigationChanged="HandleNavigationChanged" />
                }
            </MudPaper>
        </MudStack>

    </MudPaper>
}


@code {
    UserData? user = null;
    string currentPanel = "Profile";

    private void HandleNavigationChanged(string changedTo)
    {
        if (currentPanel == changedTo)
            return;

        currentPanel = changedTo;
        StateHasChanged();
    }

    protected override void OnInitialized()
    {
        user = userService.LoggedUser;
        if (user == null) return;
        user.RightUserPanelNavigation = false;
        base.OnInitialized();
    }

    private void GoHome()
    {
        navigationManager.NavigateTo("/");
    }
}
